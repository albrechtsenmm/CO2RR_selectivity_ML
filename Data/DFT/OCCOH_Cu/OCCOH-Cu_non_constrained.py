from ase import Atoms
from ase.optimize import BFGS
from ase.calculators.emt import EMT
import numpy as np
from ase.visualize import view
from ase.io import read
from ase.constraints import FixAtoms, FixBondLength
from gpaw import GPAW, PW
from ase.dft.bee import BEEFEnsemble



C_C = 1.54
O_H = 0.96
C_O = 1.43
Cu_C = 2 #roughly

Cu111=read('Metals_large.db@Metal=%s,ads=Clean' %'Cu')[0]

Cu111.set_positions([( 0.000000, 0.000000,  9.999999),
                    ( 1.303035, 0.752307, 12.127846),
                    ( 0.003453, 1.504819, 14.257350),
                    (-0.007959, 0.001686, 16.382190),
                    (-1.303035, 2.256922,  9.999999),
                    ( 0.000000, 3.009230, 12.127846),
                    (-1.298979, 3.762195, 14.258162),
                    (-1.303822, 2.256525, 16.391399),
                    (-2.606069, 4.513845,  9.999999),
                    (-1.303035, 5.266152, 12.127846),
                    (-2.608301, 6.021181, 14.222997),
                    (-2.602442, 4.507688, 16.370327),
                    ( 2.606069, 0.000000,  9.999999),
                    ( 3.909104, 0.752307, 12.127846),
                    ( 2.600568, 1.506866, 14.255501),
                    ( 2.616316, 0.003785, 16.381040),
                    ( 1.303035, 2.256922,  9.999999),
                    ( 2.606069, 3.009230, 12.127846),
                    ( 1.302439, 3.763189, 14.255238),
                    ( 1.299315, 2.430642, 16.353633),
                    ( 0.000000, 4.513845,  9.999999),
                    ( 1.303035, 5.266152, 12.127846),
                    ( 0.000672, 6.017387, 14.243264),
                    (-0.010362, 4.535945, 16.392234),
                    ( 5.212139, 0.000000,  9.999999),
                    ( 6.515174, 0.752307, 12.127846),
                    ( 5.214708, 1.502808, 14.257926),
                    ( 5.209803, 0.001837, 16.375339),
                    ( 3.909104, 2.256922,  9.999999),
                    ( 5.212139, 3.009230, 12.127846),
                    ( 3.905239, 3.764241, 14.256415),
                    ( 3.910714, 2.253289, 16.394453),
                    ( 2.606069, 4.513845,  9.999999),
                    ( 3.909104, 5.266152, 12.127846),
                    ( 2.606918, 6.018840, 14.249616),
                    ( 2.611665, 4.533521, 16.391069)])

fixed = [i for i in range(0,33,4)] + [i for i in range(1,34,4)]
c = FixAtoms(fixed)


OCCOH = Atoms('HOCCO',
            positions=[(1.367702, -0.305658, 19.732750),
                        (1.345185, -0.671294, 18.940677),
                        (1.348938, 0.195161, 17.941584),
                        (1.275624, 1.691129, 18.183691),
                        (1.328177, 2.319677, 19.467071)])

combined = Cu111 + OCCOH

combined.set_constraint([c])

calc = GPAW(xc='BEEF-vdW',
            h=0.18,
            kpts={'size': (4, 4, 1), 'gamma': True},
            basis='dzp')

combined.calc = calc
dyn = BFGS(combined, trajectory='OCCOH_non_fixedbondlength_correctHplacement.traj')
dyn.run(fmax=0.05)

#print(combined.get_positions())

